tbody.innerHTML += `
    <tr>
        <td>${statusBadge}</td>
        <td class="fw-bold">${user.username}</td>
        <td>${user.name}</td>
        <td>${user.role}</td>
        <td class="text-muted">******</td>
        <td class="${isExpired ? 'text-danger fw-bold' : ''}">${expiryText}</td>
        <td>
            <div class="btn-group">
                <button class="btn btn-sm btn-outline-warning" title="還原預設密碼" onclick="resetPassword('${user.username}')">
                    <i class="bi bi-arrow-counterclockwise"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" title="刪除帳號" onclick="deleteUser('${user.username}')">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </td>
    </tr>
`;

<script>
    // ... (原本的代碼) ...

    // 新增：還原密碼功能
    window.resetPassword = async (username) => {
        const { isConfirmed } = await Swal.fire({
            title: '確定還原密碼？',
            text: `將把 ${username} 的密碼重置為「身分證字號」。`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: '確定還原',
            cancelButtonText: '取消'
        });

        if (!isConfirmed) return;

        // 1. 去 employees 表找身分證字號
        const { data: emp, error: findError } = await db.from('employees')
            .select('national_id')
            .eq('employee_id', username) // 假設 username 就是 employee_id
            .single();

        if (findError || !emp) {
            Swal.fire('失敗', '找不到此員工的人事資料，無法還原為身分證字號。', 'error');
            return;
        }

        // 2. 更新 system_users
        const { error: updateError } = await db.from('system_users')
            .update({ password: emp.national_id }) // 設定為身分證
            .eq('username', username);

        if (updateError) {
            Swal.fire('錯誤', updateError.message, 'error');
        } else {
            Swal.fire('成功', '密碼已還原預設值！', 'success');
            loadUsers();
        }
    };
</script>
